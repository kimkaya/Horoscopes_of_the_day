<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1080, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI ìš´ì„¸ ìƒë‹´ - Fortune</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 1980px;
            width: 1080px;
            margin: 0 auto;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
            position: relative;
        }

        .header {
            display: none;
            text-align: center;
            color: white;
            margin-bottom: 30px;
            position: absolute;
            top: 40px;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
        }

        .header.show {
            display: block;
        }

        .header h1 {
            font-size: 56px;
            margin-bottom: 15px;
        }

        .header p {
            font-size: 28px;
            opacity: 0.9;
        }

        .chat-container {
            background: white;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            flex: 1;
            display: flex;
            flex-direction: column;
            max-height: 1700px;
            overflow: hidden;
        }

        .chat-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 24px 24px 0 0;
            text-align: center;
        }

        .chat-header h2 {
            font-size: 42px;
            margin-bottom: 10px;
        }

        .chat-header p {
            font-size: 24px;
            opacity: 0.9;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 40px;
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .message {
            display: flex;
            gap: 20px;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            flex-shrink: 0;
        }

        .message.user .message-avatar {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
        }

        .message-content {
            max-width: 70%;
            background: #f5f7fa;
            padding: 25px 30px;
            border-radius: 20px;
            font-size: 26px;
            line-height: 1.6;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .message-content.loading::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        .chat-input-container {
            padding: 30px 40px;
            border-top: 2px solid #f0f0f0;
            background: white;
            border-radius: 0 0 24px 24px;
        }

        .chat-input-wrapper {
            display: flex;
            gap: 15px;
        }

        .chat-input {
            flex: 1;
            padding: 25px 30px;
            border: 3px solid #e0e0e0;
            border-radius: 16px;
            font-size: 26px;
            font-family: inherit;
            transition: all 0.3s;
        }

        .chat-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .chat-input:disabled {
            background: #f5f5f5;
            cursor: not-allowed;
        }

        .send-button {
            padding: 25px 45px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 16px;
            font-size: 26px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .send-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .welcome-message {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            padding: 30px;
            border-radius: 16px;
            text-align: center;
            margin-bottom: 20px;
        }

        .welcome-message h3 {
            font-size: 32px;
            margin-bottom: 15px;
            color: #333;
        }

        .welcome-message p {
            font-size: 24px;
            color: #666;
            line-height: 1.6;
        }

        .quick-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .quick-button {
            padding: 20px;
            background: white;
            border: 3px solid #e0e0e0;
            border-radius: 12px;
            font-size: 22px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quick-button:hover {
            border-color: #667eea;
            background: #f5f7fa;
            transform: translateY(-2px);
        }

        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            font-size: 22px;
            margin: 20px;
        }

        /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ */
        .chat-messages::-webkit-scrollbar {
            width: 12px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
        }

        /* Privacy Consent Section */
        .privacy-section {
            display: none;
            background: white;
            padding: 80px 60px;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
        }

        .back-btn {
            background: transparent;
            border: none;
            color: #666;
            font-size: 36px;
            cursor: pointer;
            margin-bottom: 30px;
        }

        .privacy-section.show {
            display: block;
        }

        .icon {
            text-align: center;
            font-size: 100px;
            margin-bottom: 40px;
        }

        .privacy-content h2 {
            color: #333;
            font-size: 42px;
            margin-bottom: 30px;
            text-align: center;
        }

        .privacy-content h3 {
            color: #667eea;
            font-size: 28px;
            margin-top: 35px;
            margin-bottom: 20px;
        }

        .privacy-content p {
            color: #666;
            font-size: 22px;
            line-height: 1.8;
            margin-bottom: 20px;
        }

        .privacy-content ul {
            color: #666;
            font-size: 22px;
            line-height: 1.8;
            margin-bottom: 20px;
            padding-left: 40px;
        }

        .privacy-content li {
            margin-bottom: 12px;
        }

        .privacy-highlight {
            background: #fff3cd;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #ffc107;
            margin: 25px 0;
        }

        .privacy-buttons {
            display: flex;
            gap: 20px;
            margin-top: 40px;
        }

        .privacy-btn {
            flex: 1;
            padding: 24px;
            border: none;
            border-radius: 16px;
            font-size: 26px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .privacy-btn.agree {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .privacy-btn.agree:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .privacy-btn.disagree {
            background: #f5f5f5;
            color: #666;
        }

        .privacy-btn.disagree:hover {
            background: #e0e0e0;
        }

        /* User Info Section */
        .user-info-section {
            display: none;
            background: white;
            padding: 80px 60px;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
        }

        .user-info-section.show {
            display: block;
        }

        .user-info-content h2 {
            color: #333;
            font-size: 42px;
            margin-bottom: 30px;
            text-align: center;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            font-size: 26px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 20px;
            font-size: 24px;
            border: 3px solid #e0e0e0;
            border-radius: 12px;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .form-buttons {
            display: flex;
            gap: 20px;
            margin-top: 40px;
        }

        .form-btn {
            flex: 1;
            padding: 24px;
            border: none;
            border-radius: 16px;
            font-size: 26px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .form-btn.submit {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .form-btn.submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .form-btn.back {
            background: #f5f5f5;
            color: #666;
        }

        .form-btn.back:hover {
            background: #e0e0e0;
        }

        .main-content {
            display: none;
            margin-top: 150px;
        }

        .main-content.show {
            display: flex;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ¤– AI ìš´ì„¸ ìƒë‹´</h1>
        <p>ì¸ê³µì§€ëŠ¥ê³¼ í•¨ê»˜í•˜ëŠ” ìš´ì„¸ ìƒë‹´</p>
    </div>

    <!-- Privacy Consent Section -->
    <div class="privacy-section" id="privacySection">
        <div class="privacy-content">
            <button class="back-btn" onclick="window.location.href='index.html'">â† ë’¤ë¡œ</button>
            <div class="icon">ğŸ¤–</div>
            <h2>ğŸ”’ ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš© ë™ì˜</h2>

            <p>Fortune AI ìš´ì„¸ ìƒë‹´ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ì‹œê¸° ì „ì— ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš©ì— ëŒ€í•œ ë™ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.</p>

            <h3>1. ìˆ˜ì§‘í•˜ëŠ” ê°œì¸ì •ë³´ í•­ëª©</h3>
            <ul>
                <li><strong>í•„ìˆ˜ ì •ë³´:</strong> ì´ë¦„, ìƒë…„ì›”ì¼, ì„±ë³„</li>
                <li><strong>ì„ íƒ ì •ë³´:</strong> ì¶œìƒì‹œê°„</li>
            </ul>

            <h3>2. ê°œì¸ì •ë³´ì˜ ìˆ˜ì§‘ ë° ì´ìš© ëª©ì </h3>
            <ul>
                <li>ë§ì¶¤í˜• ìš´ì„¸ ê²°ê³¼ ì œê³µ</li>
                <li>ìš´ì„¸ ê¸°ë¡ ì €ì¥ ë° ê´€ë¦¬</li>
                <li>ì„œë¹„ìŠ¤ ê°œì„  ë° í†µê³„ ë¶„ì„</li>
            </ul>

            <h3>3. ê°œì¸ì •ë³´ì˜ ë³´ìœ  ë° ì´ìš© ê¸°ê°„</h3>
            <p>ìˆ˜ì§‘ëœ ê°œì¸ì •ë³´ëŠ” <strong>ì„œë¹„ìŠ¤ ì œê³µ ê¸°ê°„ ë™ì•ˆ</strong> ë³´ê´€ë˜ë©°, ì‚¬ìš©ìê°€ ì‚­ì œë¥¼ ìš”ì²­í•  ê²½ìš° ì¦‰ì‹œ íŒŒê¸°ë©ë‹ˆë‹¤.</p>

            <h3>4. ê°œì¸ì •ë³´ì˜ ì œ3ì ì œê³µ</h3>
            <p>ìˆ˜ì§‘ëœ ê°œì¸ì •ë³´ëŠ” <strong>ì œ3ìì—ê²Œ ì œê³µë˜ì§€ ì•ŠìŠµë‹ˆë‹¤</strong>. ì˜¤ì§ ìš´ì„¸ ì„œë¹„ìŠ¤ ì œê³µ ëª©ì ìœ¼ë¡œë§Œ ì‚¬ìš©ë©ë‹ˆë‹¤.</p>

            <div class="privacy-highlight">
                <p style="margin: 0; font-weight: 600; font-size: 22px;">
                    âš ï¸ ìœ„ ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš©ì— ë™ì˜í•˜ì§€ ì•Šìœ¼ì‹¤ ê²½ìš°, ìš´ì„¸ ì„œë¹„ìŠ¤ ì´ìš©ì´ ì œí•œë©ë‹ˆë‹¤.
                </p>
            </div>

            <div class="privacy-buttons">
                <button class="privacy-btn disagree" onclick="handlePrivacyDisagree()">ë™ì˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤</button>
                <button class="privacy-btn agree" onclick="handlePrivacyAgree()">ë™ì˜í•©ë‹ˆë‹¤</button>
            </div>
        </div>
    </div>

    <!-- User Info Section -->
    <div class="user-info-section" id="userInfoSection">
        <div class="user-info-content">
            <h2>ğŸ‘¤ ê°œì¸ì •ë³´ ì…ë ¥</h2>

            <form id="userInfoForm">
                <div class="form-group">
                    <label for="userName">ì´ë¦„ *</label>
                    <input type="text" id="userName" name="userName" required placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
                </div>

                <div class="form-group">
                    <label for="userBirthdate">ìƒë…„ì›”ì¼ *</label>
                    <input type="date" id="userBirthdate" name="userBirthdate" required>
                </div>

                <div class="form-group">
                    <label for="userBirthTime">ì¶œìƒì‹œê°„ (ì„ íƒ)</label>
                    <input type="time" id="userBirthTime" name="userBirthTime" placeholder="ì¶œìƒì‹œê°„ì„ ì…ë ¥í•˜ì„¸ìš”">
                </div>

                <div class="form-group">
                    <label for="userGender">ì„±ë³„ *</label>
                    <select id="userGender" name="userGender" required>
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="M">ë‚¨ì„±</option>
                        <option value="F">ì—¬ì„±</option>
                    </select>
                </div>

                <div class="form-buttons">
                    <button type="button" class="form-btn back" onclick="showPrivacySection()">ì´ì „</button>
                    <button type="submit" class="form-btn submit">ìƒë‹´ ì‹œì‘í•˜ê¸°</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Main Chat Content -->
    <div class="chat-container main-content" id="mainContent">
        <div class="chat-header">
            <h2>ğŸ’¬ AI ìƒë‹´ì‚¬ì™€ ëŒ€í™”í•˜ê¸°</h2>
            <p>ìš´ì„¸ì™€ ê´€ë ¨ëœ ê³ ë¯¼ì„ í¸í•˜ê²Œ ìƒë‹´í•˜ì„¸ìš”</p>
        </div>

        <div class="chat-messages" id="chatMessages">
            <div class="welcome-message">
                <h3>ì•ˆë…•í•˜ì„¸ìš”! ğŸ‘‹</h3>
                <p>
                    ì €ëŠ” AI ìš´ì„¸ ìƒë‹´ì‚¬ì…ë‹ˆë‹¤.<br>
                    íƒ€ë¡œ, ì‚¬ì£¼, ë³„ìë¦¬ ë“± ìš´ì„¸ì™€ ê´€ë ¨ëœ<br>
                    ê³ ë¯¼ì´ë‚˜ ê¶ê¸ˆí•œ ì ì„ ë§ì”€í•´ì£¼ì„¸ìš”.
                </p>
                <div class="quick-buttons">
                    <button class="quick-button" onclick="sendQuickMessage('ì˜¤ëŠ˜ì˜ ìš´ì„¸ë¥¼ ì•Œë ¤ì£¼ì„¸ìš”')">
                        â˜€ï¸ ì˜¤ëŠ˜ì˜ ìš´ì„¸
                    </button>
                    <button class="quick-button" onclick="sendQuickMessage('ë‚´ íƒ€ë¡œ ê²°ê³¼ë¥¼ í•´ì„í•´ì£¼ì„¸ìš”')">
                        ğŸƒ íƒ€ë¡œ í•´ì„
                    </button>
                    <button class="quick-button" onclick="sendQuickMessage('ì‚¬ì£¼ì— ëŒ€í•´ ê¶ê¸ˆí•´ìš”')">
                        ğŸ“¿ ì‚¬ì£¼ ìƒë‹´
                    </button>
                    <button class="quick-button" onclick="sendQuickMessage('ì—°ì• ìš´ì„ ì•Œë ¤ì£¼ì„¸ìš”')">
                        ğŸ’• ì—°ì• ìš´
                    </button>
                </div>
            </div>
        </div>

        <div class="chat-input-container">
            <div class="chat-input-wrapper">
                <input
                    type="text"
                    class="chat-input"
                    id="chatInput"
                    placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."
                    onkeypress="handleKeyPress(event)"
                >
                <button class="send-button" id="sendButton" onclick="sendMessage()">
                    ì „ì†¡
                </button>
            </div>
        </div>
    </div>

    <script>
        let conversationHistory = [];
        let isLoading = false;
        let userData = null;
        let contextInfo = {
            dateTime: null,
            weather: null,
            location: null
        };

        // í˜„ì¬ ë‚ ì§œ/ì‹œê°„ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        function getDateTimeInfo() {
            const now = new Date();
            const days = ['ì¼ìš”ì¼', 'ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼', 'í† ìš”ì¼'];

            return {
                date: now.toLocaleDateString('ko-KR', { year: 'numeric', month: 'long', day: 'numeric' }),
                time: now.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' }),
                dayOfWeek: days[now.getDay()],
                hour: now.getHours()
            };
        }

        // ë‚ ì”¨ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        async function getWeatherInfo() {
            return new Promise((resolve) => {
                if (!navigator.geolocation) {
                    resolve(null);
                    return;
                }

                navigator.geolocation.getCurrentPosition(
                    async (position) => {
                        try {
                            const lat = position.coords.latitude;
                            const lon = position.coords.longitude;

                            // OpenWeatherMap API ë¬´ë£Œ ë²„ì „ ì‚¬ìš©
                            const apiKey = ''; // API í‚¤ëŠ” ë¹„ì›Œë‘  - ì‚¬ìš©ìê°€ ì„¤ì • í•„ìš”
                            if (!apiKey) {
                                // API í‚¤ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ ì •ë³´ë§Œ ë°˜í™˜
                                resolve({
                                    location: 'í˜„ì¬ ìœ„ì¹˜',
                                    description: 'ì •ë³´ ì—†ìŒ'
                                });
                                return;
                            }

                            const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric&lang=kr`;
                            const response = await fetch(url);
                            const data = await response.json();

                            resolve({
                                location: data.name || 'í˜„ì¬ ìœ„ì¹˜',
                                temp: Math.round(data.main.temp),
                                description: data.weather[0].description,
                                humidity: data.main.humidity
                            });
                        } catch (error) {
                            console.error('ë‚ ì”¨ ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
                            resolve(null);
                        }
                    },
                    (error) => {
                        console.error('ìœ„ì¹˜ ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
                        resolve(null);
                    }
                );
            });
        }

        // ì»¨í…ìŠ¤íŠ¸ ì •ë³´ ìˆ˜ì§‘
        async function collectContextInfo() {
            contextInfo.dateTime = getDateTimeInfo();
            contextInfo.weather = await getWeatherInfo();
        }

        // Always show privacy consent section first
        window.addEventListener('DOMContentLoaded', function() {
            // Always show privacy consent section
            document.getElementById('privacySection').classList.add('show');

            // ì»¨í…ìŠ¤íŠ¸ ì •ë³´ ìˆ˜ì§‘ ì‹œì‘
            collectContextInfo();

            // ê°œì¸ì •ë³´ ì…ë ¥ í¼ ì œì¶œ
            document.getElementById('userInfoForm').addEventListener('submit', function(e) {
                e.preventDefault();
                submitUserInfo();
            });
        });

        function handlePrivacyAgree() {
            // Hide privacy section and show user info section
            document.getElementById('privacySection').classList.remove('show');
            document.getElementById('userInfoSection').classList.add('show');
        }

        function handlePrivacyDisagree() {
            alert('ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš©ì— ë™ì˜í•˜ì§€ ì•Šìœ¼ì‹œë©´ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ì‹¤ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            window.location.href = 'index.html';
        }

        function showPrivacySection() {
            document.getElementById('userInfoSection').classList.remove('show');
            document.getElementById('privacySection').classList.add('show');
        }

        function submitUserInfo() {
            const name = document.getElementById('userName').value.trim();
            const birthdate = document.getElementById('userBirthdate').value;
            const birthTime = document.getElementById('userBirthTime').value;
            const gender = document.getElementById('userGender').value;

            if (!name || !birthdate || !gender) {
                alert('í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // ì‚¬ìš©ì ì •ë³´ ì €ì¥
            userData = {
                name: name,
                birthdate: birthdate,
                birthTime: birthTime || null,
                gender: gender
            };

            // Hide user info section and show main content
            document.getElementById('userInfoSection').classList.remove('show');
            document.querySelector('.header').classList.add('show');
            document.getElementById('mainContent').classList.add('show');

            // í™˜ì˜ ë©”ì‹œì§€ì— ì´ë¦„ ì¶”ê°€
            const welcomeMessage = document.querySelector('.welcome-message h3');
            welcomeMessage.textContent = `ì•ˆë…•í•˜ì„¸ìš”, ${name}ë‹˜! ğŸ‘‹`;

            // ì…ë ¥ì°½ í¬ì»¤ìŠ¤
            document.getElementById('chatInput').focus();
        }

        function addMessage(content, isUser) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'ai'}`;

            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = isUser ? 'ğŸ‘¤' : 'ğŸ¤–';

            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.textContent = content;

            messageDiv.appendChild(avatar);
            messageDiv.appendChild(contentDiv);

            messagesContainer.appendChild(messageDiv);

            // ìŠ¤í¬ë¡¤ì„ ë§¨ ì•„ë˜ë¡œ
            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            return contentDiv;
        }

        function showLoadingMessage() {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message ai';
            messageDiv.id = 'loadingMessage';

            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = 'ğŸ¤–';

            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content loading';
            contentDiv.textContent = 'AIê°€ ë‹µë³€ì„ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤';

            messageDiv.appendChild(avatar);
            messageDiv.appendChild(contentDiv);

            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function hideLoadingMessage() {
            const loadingMessage = document.getElementById('loadingMessage');
            if (loadingMessage) {
                loadingMessage.remove();
            }
        }

        function showError(message) {
            const messagesContainer = document.getElementById('chatMessages');
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.textContent = message;
            messagesContainer.appendChild(errorDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();

            if (!message || isLoading) return;

            // ì»¨í…ìŠ¤íŠ¸ ì •ë³´ ì—…ë°ì´íŠ¸ (ë©”ì‹œì§€ ì „ì†¡ ì‹œ ìµœì‹  ì •ë³´ ìˆ˜ì§‘)
            contextInfo.dateTime = getDateTimeInfo();

            // ì‚¬ìš©ì ë©”ì‹œì§€ ì¶”ê°€
            addMessage(message, true);
            conversationHistory.push({
                role: 'user',
                content: message
            });

            // ì…ë ¥ì°½ ì´ˆê¸°í™”
            input.value = '';
            isLoading = true;
            document.getElementById('chatInput').disabled = true;
            document.getElementById('sendButton').disabled = true;

            // ë¡œë”© ë©”ì‹œì§€ í‘œì‹œ
            showLoadingMessage();

            try {
                const response = await fetch('../Fortune_api/ai_consult.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,
                        history: conversationHistory,
                        userData: userData,
                        contextInfo: contextInfo
                    })
                });

                const data = await response.json();

                hideLoadingMessage();

                if (data.success) {
                    // AI ì‘ë‹µ ì¶”ê°€
                    addMessage(data.message, false);
                    conversationHistory.push({
                        role: 'assistant',
                        content: data.message
                    });
                } else {
                    showError(data.message || 'AI ì‘ë‹µì„ ë°›ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                hideLoadingMessage();
                console.error('Error:', error);
                showError('AI ìƒë‹´ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            } finally {
                isLoading = false;
                document.getElementById('chatInput').disabled = false;
                document.getElementById('sendButton').disabled = false;
                document.getElementById('chatInput').focus();
            }
        }

        function sendQuickMessage(message) {
            document.getElementById('chatInput').value = message;
            sendMessage();
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !isLoading) {
                sendMessage();
            }
        }

    </script>
</body>
</html>
